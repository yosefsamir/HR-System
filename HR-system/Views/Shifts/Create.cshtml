@model HR_system.DTOs.Shift.CreateShiftDto
@using HR_system.Models.Enums

@{
    ViewData["Title"] = "إضافة وردية جديدة";
    ViewData["PageTitle"] = "إضافة وردية جديدة";
    ViewData["PageIcon"] = "bi-plus-circle";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">
                <i class="bi bi-plus-circle text-primary me-2"></i>
                إضافة وردية جديدة
            </h4>
            <p class="text-muted mb-0">قم بإدخال بيانات الوردية الجديدة</p>
        </div>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-right me-2"></i>
            العودة للقائمة
        </a>
    </div>

    <!-- Add Shift Card -->
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="bi bi-clock me-2"></i>
                بيانات الوردية
            </h5>
        </div>
        <div class="card-body">
            <!-- Salary Calculation Type Help -->
            <div class="alert alert-info mb-4" role="alert">
                <h6 class="alert-heading">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    طرق حساب الراتب
                </h6>
                <hr class="my-2">
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex align-items-start mb-2">
                            <span class="badge bg-primary me-2 mt-1">بالساعة</span>
                            <div>
                                <strong>الراتب = ساعات العمل × أجر الساعة</strong>
                                <br>
                                <small class="text-muted">
                                    يتم احتساب الراتب بناءً على عدد الساعات الفعلية التي عملها الموظف، 
                                    مع إضافة ساعات العمل الإضافي وخصم ساعات التأخير
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <span class="badge bg-warning text-dark me-2 mt-1">باليوم</span>
                            <div>
                                <strong>الراتب = أيام الحضور × أجر اليوم</strong>
                                <br>
                                <small class="text-muted">
                                    إذا حضر الموظف في يوم ما، يحصل على أجر اليوم كاملاً بغض النظر عن عدد الساعات، 
                                    مع إضافة ساعات العمل الإضافي وخصم ساعات التأخير
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <form asp-action="Create" method="post">
                @Html.AntiForgeryToken()
                
                <div class="row g-4">
                    <!-- Basic Info Section -->
                    <div class="col-12">
                        <h6 class="text-muted border-bottom pb-2 mb-3">
                            <i class="bi bi-info-circle me-2"></i>
                            المعلومات الأساسية
                        </h6>
                    </div>
                    
                    <div class="col-md-6">
                        <label asp-for="Shift_name" class="form-label">
                            <i class="bi bi-tag me-1 text-primary"></i>
                            اسم الوردية
                        </label>
                        <input asp-for="Shift_name" class="form-control form-control-lg" placeholder="مثال: الوردية الصباحية" />
                        <span asp-validation-for="Shift_name" class="text-danger"></span>
                    </div>
                    
                    <div class="col-md-3">
                        <label asp-for="Start_time" class="form-label">
                            <i class="bi bi-play-circle me-1 text-success"></i>
                            وقت البداية
                        </label>
                        <input asp-for="Start_time" type="time" class="form-control form-control-lg" />
                        <span asp-validation-for="Start_time" class="text-danger"></span>
                    </div>
                    
                    <div class="col-md-3">
                        <label asp-for="End_time" class="form-label">
                            <i class="bi bi-stop-circle me-1 text-danger"></i>
                            وقت الانتهاء
                        </label>
                        <input asp-for="End_time" type="time" class="form-control form-control-lg" />
                        <span asp-validation-for="End_time" class="text-danger"></span>
                    </div>

                    <!-- Work Hours Section -->
                    <div class="col-12 mt-4">
                        <h6 class="text-muted border-bottom pb-2 mb-3">
                            <i class="bi bi-clock-history me-2"></i>
                            ساعات العمل والحساب
                        </h6>
                    </div>
                    
                    <div class="col-md-4">
                        <label asp-for="StandardHours" class="form-label">
                            <i class="bi bi-hourglass-split me-1 text-info"></i>
                            ساعات العمل القياسية
                            <i class="bi bi-info-circle-fill text-warning ms-1" 
                               data-bs-toggle="tooltip" 
                               title="ساعات العمل هي المستخدمة لحساب راتب الساعة"></i>
                        </label>
                        <div class="input-group">
                            <input asp-for="StandardHours" type="number" step="0.5" class="form-control form-control-lg" min="0.5" max="24" />
                            <span class="input-group-text">ساعة</span>
                        </div>
                        <span asp-validation-for="StandardHours" class="text-danger"></span>
                    </div>
                    
                    <div class="col-md-4">
                        <label asp-for="SalaryCalculationType" class="form-label">
                            <i class="bi bi-calculator me-1 text-info"></i>
                            طريقة حساب الراتب
                        </label>
                        <select asp-for="SalaryCalculationType" class="form-select form-select-lg">
                            <option value="@SalaryCalculationType.Hourly">بالساعة (ساعات العمل × أجر الساعة)</option>
                            <option value="@SalaryCalculationType.Daily">باليوم (أيام الحضور × أجر اليوم)</option>
                        </select>
                        <span asp-validation-for="SalaryCalculationType" class="text-danger"></span>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="bi bi-arrow-left-right me-1 text-warning"></i>
                            نوع الوردية
                        </label>
                        <div class="form-control form-control-lg bg-dark border-secondary">
                            <div class="form-check">
                                <input asp-for="IsFlexible" class="form-check-input" />
                                <label asp-for="IsFlexible" class="form-check-label">
                                    وردية مرنة (بدون قيود زمنية)
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Tolerance Section -->
                    <div class="col-12 mt-4">
                        <h6 class="text-muted border-bottom pb-2 mb-3">
                            <i class="bi bi-shield-check me-2"></i>
                            السماحات
                        </h6>
                    </div>
                    
                    <div class="col-md-6">
                        <label asp-for="Minutes_allow_attendence" class="form-label">
                            <i class="bi bi-box-arrow-in-left me-1 text-success"></i>
                            سماح الحضور
                            <small class="text-muted">(الدقائق المسموحة للتأخير بعد وقت البداية)</small>
                        </label>
                        <div class="input-group">
                            <input asp-for="Minutes_allow_attendence" type="number" class="form-control form-control-lg" min="0" max="120" />
                            <span class="input-group-text">دقيقة</span>
                        </div>
                        <span asp-validation-for="Minutes_allow_attendence" class="text-danger"></span>
                    </div>
                    
                    <div class="col-md-6">
                        <label asp-for="Minutes_allow_departure" class="form-label">
                            <i class="bi bi-box-arrow-right me-1 text-danger"></i>
                            سماح الانصراف
                            <small class="text-muted">(الدقائق المسموحة للخروج المبكر قبل وقت الانتهاء)</small>
                        </label>
                        <div class="input-group">
                            <input asp-for="Minutes_allow_departure" type="number" class="form-control form-control-lg" min="0" max="120" />
                            <span class="input-group-text">دقيقة</span>
                        </div>
                        <span asp-validation-for="Minutes_allow_departure" class="text-danger"></span>
                    </div>

                    <!-- Early Departure Multiplier Section -->
                    <div class="col-12 mt-4">
                        <h6 class="text-muted border-bottom pb-2 mb-3">
                            <i class="bi bi-clock-history me-2"></i>
                            معاملات الخصم
                        </h6>
                    </div>
                    
                    <div class="col-md-6">
                        <label asp-for="EarlyDepartureMultiplier" class="form-label">
                            <i class="bi bi-dash-circle me-1 text-danger"></i>
                            معامل خصم الخروج المبكر
                            <i class="bi bi-info-circle-fill text-warning ms-1" 
                               data-bs-toggle="tooltip" 
                               title="المعامل المستخدم لحساب خصم الخروج المبكر. مثال: 1.5 يعني خصم 1.5 ضعف أجر الساعة عن كل ساعة خروج مبكر"></i>
                        </label>
                        <div class="input-group">
                            <input asp-for="EarlyDepartureMultiplier" type="number" step="0.5" class="form-control form-control-lg" min="0" max="10" value="1" />
                            <span class="input-group-text">×</span>
                        </div>
                        <span asp-validation-for="EarlyDepartureMultiplier" class="text-danger"></span>
                        <small class="text-muted">القيمة الافتراضية: 1 (أي خصم أجر الساعة العادي)</small>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="row mt-5">
                    <div class="col-12">
                        <hr class="border-secondary">
                        <div class="d-flex justify-content-between">
                            <a asp-action="Index" class="btn btn-outline-secondary btn-lg">
                                <i class="bi bi-x-lg me-2"></i>
                                إلغاء
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-plus-lg me-2"></i>
                                إضافة الوردية
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>
}
